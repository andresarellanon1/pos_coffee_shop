<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="highway_report_template">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-set="lang" t-value="doc.operating_unit_id.partner_id.lang"/>
                <t t-call="tms.highway_report_body_template" t-lang="lang"/>
            </t>
        </t>
    </template>

    <template id="highway_report_body_template">
        <t t-call="tms.report_pdf_external_layout">
            <t t-set="doc" t-value="doc.with_context(lang=lang)"/>
            <div class="header">
                <div class="row">
                    <div class="text-center">
                        <span style="color: black; font-size: 15px" t-esc="doc.operating_unit_id.partner_id.name"/>
                        <br/>
                        <span style="color: black; font-size: 15px" t-esc="doc.operating_unit_id.partner_id.street"/>
                        <span style="color: black; font-size: 15px" t-esc="doc.operating_unit_id.partner_id.street2"/>
                        <span style="color: black; font-size: 15px" t-esc="doc.operating_unit_id.partner_id.zip"/>
                        <br/>
                        <span style="color: black; font-size: 15px" t-esc="doc.operating_unit_id.partner_id.vat"/>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12" style="text-align: center">
                        <span style="font-weight: bold; color: black; font-size: 15px">Impression of Settlement Expenses (Detailed)</span>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12" style="text-align: center">
                        <span style="font-weight: bold; color: black; font-size: 15px">
                            Between Settlements:
                            <span t-field="doc.name"/>
                            to
                            <span t-field="docs[-1].name"/>
                        </span>
                    </div>
                </div>
            </div>
            <div class="page col-12">
                <div class="row">
                    <table class="table" style="box-shadow: inset 0px 0px 5px 0px rgba(0,0,0,1); background-color:#D8D8D8">
                        <tr>
                            <th style="width:20%">
                                <span style="color: black; font-weight: bold; font-size: 14px">Expense</span>
                            </th>
                            <th style="width:20%">
                                <span style="color: black; font-weight: bold; font-size: 14px">Unit</span>
                            </th>
                            <th style="width:30%">
                                <span style="color: black; font-weight: bold; font-size: 14px">Expense Date</span>
                            </th>
                            <th style="width:30%">
                                <span style="color: black; font-weight: bold; font-size: 14px">Driver</span>
                            </th>
                        </tr>
                        <tr>
                            <td>
                                <span style="color: black; font-size: 13px" t-field="doc.name"/>
                            </td>
                            <td>
                                <span style="color: black; font-size: 13px" t-field="doc.unit_id"/>
                            </td>
                            <td>
                                <span style="color: black; font-size: 13px" t-field="doc.date"/>
                            </td>
                            <td>
                                <span style="color: black; font-size: 13px" t-field="doc.employee_id"/>
                            </td>
                        </tr>
                    </table>
                </div>

                <div class="row">
                    <table class="table table-bordered">
                        <tr>
                            <th style="background-color: #D8D8D8; color: black; font-size: 13.5px">Travel</th>
                            <th style="background-color: #D8D8D8; color: black; font-size: 13.5px">Expense Concept</th>
                            <th style="background-color: #D8D8D8; color: black; font-size: 13.5px">Date</th>
                            <th style="background-color: #D8D8D8; color: black; font-size: 13.5px">Amount</th>
                            <th style="background-color: #D8D8D8; color: black; font-size: 13.5px">Taxes</th>
                            <th style="background-color: #D8D8D8; color: black; font-size: 13.5px">Total</th>
                            <th style="background-color: #D8D8D8; color: black; font-size: 13.5px">Creation Date</th>
                        </tr>

                        <t t-as="expense_line" t-foreach="doc.expense_line_ids">
                            <t t-if="expense_line.line_type == 'tollstations'">
                                <t t-set="tollstation_lines" t-value="expense_line.sort_expense_lines()"/>

                                <tr t-as="tollstation" t-foreach="tollstation_lines">
                                    <td width="10%">
                                        <span style="font-size: 12.5px; color: black" t-field="tollstation.expense_line_id.travel_id.name"/>
                                    </td>
                                    <td width="20%">
                                        <span style="font-size: 12.5px; color: black" t-field="tollstation.name"/>
                                    </td>
                                    <td width="20%">
                                        <span style="font-size: 12.5px; color: black" t-field="tollstation.date"/>
                                    </td>
                                    <td width="10%">
                                        <span style="font-size: 12.5px; color: black" t-esc="round((tollstation.import_rate * 100) / 116, 2)"/>
                                    </td>
                                    <td width="10%">
                                        <span style="font-size: 12.5px; color: black" t-esc="round((tollstation.import_rate * 16) / 116, 2)"/>
                                    </td>
                                    <td width="10%">
                                        <span style="font-size: 12.5px; color: black" t-field="tollstation.import_rate"/>
                                    </td>
                                    <td width="20%">
                                        <span style="font-size: 12.5px; color: black" t-field="tollstation.create_date"/>
                                    </td>
                                </tr>
                            </t>
                        </t>
                    </table>
                </div>

                <div class="row">
                    <div class="col-3">
                    </div>
                    <div class="col-4">
                    </div>
                    <div class="col-5">
                        <table class="table table-condensed">
                            <t t-set="subtotal" t-value="0"/>

                            <p t-foreach="doc.expense_line_ids" t-as="expense_line">
                                <t t-if="expense_line.line_type == 'tollstations'">
                                    <t t-set="subtotal" t-value="round(subtotal+expense_line.price_subtotal, 2)"/>
                                </t>
                            </p>
                            <t t-set="tax_amount" t-value="0"/>
                            <p t-foreach="doc.expense_line_ids" t-as="expense_line">
                                <t t-if="expense_line.line_type == 'tollstations'">
                                    <t t-set="tax_amount" t-value="round(tax_amount+expense_line.tax_amount, 2)"/>
                                </t>
                            </p>
                            <t t-set="total" t-value="0"/>
                            <p t-foreach="doc.expense_line_ids" t-as="expense_line">
                                <t t-if="expense_line.line_type == 'tollstations'">
                                    <t t-set="total" t-value="round(total+expense_line.price_total, 2)"/>
                                </t>
                            </p>

                            <tr>
                                <th style="background-color:#D8D8D8">
                                    <span/>
                                </th>
                                <th style="background-color:#D8D8D8">
                                    <span style="color: black; font-size: 13.5px">Amount</span>
                                </th>
                                <th style="background-color:#D8D8D8">
                                    <span style="color: black; font-size: 13.5px">Taxes</span>
                                </th>
                                <th style="background-color:#D8D8D8">
                                    <span style="color: black; font-size: 13.5px">Total</span>
                                </th>
                            </tr>

                            <tr>
                                <td>
                                    <span style="font-size: 13.5px; font-weight: bold; color: black">Concept Total: </span>
                                </td>
                                <td>
                                    <span style="font-size: 12.5px; color: black" t-esc="subtotal"/>
                                </td>
                                <td>
                                    <span style="font-size: 12.5px; color: black" t-esc="tax_amount"/>
                                </td>
                                <td>
                                    <span style="font-size: 12.5px; color: black" t-esc="total"/>
                                </td>
                            </tr>

                            <tr>
                                <td>
                                    <span style="font-size: 13.5px; font-weight: bold; color: black">Expense Total: </span>
                                </td>
                                <td>
                                    <span style="font-size: 12.5px; color: black" t-esc="subtotal"/>
                                </td>
                                <td>
                                    <span style="font-size: 12.5px; color: black" t-esc="tax_amount"/>
                                </td>
                                <td>
                                    <span style="font-size: 12.5px; color: black" t-esc="total"/>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
            <div class="footer">
            </div>
        </t>
    </template>
</odoo>
